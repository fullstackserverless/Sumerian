(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{155:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return i})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return l}));var a=t(1),r=(t(0),t(174));const o={id:"auth1-02",title:"Authentication",sidebar_label:"Custom setup"},i={id:"auth1-02",title:"Authentication",description:"Firstly, the standard UI from Amplify does not always meet customer UX requirements",source:"@site/docs/auth1.02.md",permalink:"/docs/auth1-02",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/auth1.02.md",sidebar_label:"Custom setup",sidebar:"someSidebar",previous:{title:"Authentication",permalink:"/docs/auth1-01"},next:{title:"AWS Amplify",permalink:"/docs/amplify-00"}},s=[{value:"Clone the repository",id:"clone-the-repository",children:[]},{value:"Initializing AWS Amplify in a React Native Project",id:"initializing-aws-amplify-in-a-react-native-project",children:[]},{value:"Connect authentication plugin",id:"connect-authentication-plugin",children:[]},{value:"Connect AWS Amplify to React Native",id:"connect-aws-amplify-to-react-native",children:[]},{value:"Add navigation",id:"add-navigation",children:[]},{value:"react-native-keychain",id:"react-native-keychain",children:[]},{value:"AppNavigator",id:"appnavigator",children:[]},{value:"Hello screen",id:"hello-screen",children:[]},{value:"SignUp screen",id:"signup-screen",children:[]},{value:"ConfirmSignUp screen",id:"confirmsignup-screen",children:[]},{value:"ResendSignUp",id:"resendsignup",children:[]},{value:"User screen",id:"user-screen",children:[]},{value:"SignIn screen",id:"signin-screen",children:[]},{value:"Forgot password screen",id:"forgot-password-screen",children:[]},{value:"Forgot password submit",id:"forgot-password-submit",children:[]},{value:"Linking screens",id:"linking-screens",children:[]},{value:"Udpate AppNavigator",id:"udpate-appnavigator",children:[]},{value:"Debug",id:"debug",children:[]},{value:"Done \u2705",id:"done-",children:[]}],c={rightToc:s};function l({components:e,...n}){return Object(r.b)("wrapper",Object(a.a)({},c,n,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Firstly, the standard UI from Amplify does not always meet customer UX requirements"),Object(r.b)("p",null,"Secondly, in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.amplify.aws/lib/auth/manageusers/q/platform/js#managing-security-tokens"}),"official documentation")," of Amplify it is stated that:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Data is stored unencrypted when using standard storage adapters (localStorage in the browser and AsyncStorage on React Native). Amplify gives you the option to use your own storage object to persist data. With this, you could write a thin wrapper around libraries like:\nreact-native-keychain\nreact-native-secure-storage\nExpo\u2019s secure store")),Object(r.b)("p",null,"This means that the authentication data is stored in an unencrypted form, and this is a risk\n\ud83d\udd77 of information security with possible negative consequences \ud83d\udd78."),Object(r.b)("p",null,"Source code for this part is available on ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/fullstackserverless/auth/tree/part2"}),"GitHub"),"."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://youtu.be/QMObthDaewQ"}),Object(r.b)("img",Object(a.a)({parentName:"a"},{src:"/img/auth/00.gif",alt:"AWS Amplify"})))),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/01.png",alt:"Step01"}))),Object(r.b)("h2",{id:"clone-the-repository"},"Clone the repository"),Object(r.b)("p",null,"Install the repository with the pre-installed ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://fullstackserverless.github.io/docs/unicorn00"}),"UI Kit")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"git clone https://github.com/fullstackserverless/auth.git\n")),Object(r.b)("p",null,"Go to the project folder"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"cd auth\n")),Object(r.b)("p",null,"Install dependencies"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"yarn")),Object(r.b)("p",null,"or"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"npm install")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/02.png",alt:"Step02"}))),Object(r.b)("h2",{id:"initializing-aws-amplify-in-a-react-native-project"},"Initializing AWS Amplify in a React Native Project"),Object(r.b)("p",null,"Initialize our AWS Amplify project in the root directory."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"amplify init\n")),Object(r.b)("p",null,"Answer these questions:"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth02.png",alt:"amplify init"}))),Object(r.b)("p",null,"The project successfully initialized \ud83d\ude80"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/03.png",alt:"Step03"}))),Object(r.b)("h2",{id:"connect-authentication-plugin"},"Connect authentication plugin"),Object(r.b)("p",null,"Now that the application is in the cloud, you can add some features, such as allowing users to register with our application and log in."),Object(r.b)("p",null,"Use command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"amplify add auth\n")),Object(r.b)("p",null,"Connect the authentication function. Select the default configuration. This adds auth resource configurations locally to your ampify/backend/auth directory"),Object(r.b)("div",{class:"alert alert--info",role:"alert"},"\ud83d\udccc Select the profile we want to use. default. Enter and how users will log in. Email (write off money for SMS)."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth03.png",alt:"amplify init"}))),Object(r.b)("p",null,"Submit changes to the cloud \ud83d\udcad"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"amplify push\n")),Object(r.b)("p",null,"\u2714 All resources are updated in the cloud"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/04.png",alt:"Step04"}))),Object(r.b)("h2",{id:"connect-aws-amplify-to-react-native"},"Connect AWS Amplify to React Native"),Object(r.b)("p",null,"Details can be found in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://aws-amplify.github.io/docs/js/react"}),"this")," instruction \ud83d\udcc3.In short, you can add these dependencies below to connect AWS Amplify:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"yarn add aws-amplify @aws-amplify/core aws-amplify-react-native amazon-cognito-identity-js @react-native-community/netinfo\n")),Object(r.b)("p",null,"After installation, make sure to go to the ios folder and set the pods"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"cd ios && pod install && cd ..\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/05.png",alt:"Step05"}))),Object(r.b)("h2",{id:"add-navigation"},"Add navigation"),Object(r.b)("p",null,"install react-navigation v5, based on this instruction ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://reactnavigation.org/docs/getting-started/"}),"here"),"\n(at the time of writing this article this is latest version of navigation)"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"yarn add react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view @react-navigation/stack\n")),Object(r.b)("p",null,"Add pods for iOS"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"cd ios && pod install && cd ..\n")),Object(r.b)("div",{class:"alert alert--info",role:"alert"},"\ud83d\udccc I recommend to launch the application for iOS and Android, after each installation, in order to avoid searching for the library because of which the application crashes."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/06.png",alt:"Step06"}))),Object(r.b)("h2",{id:"react-native-keychain"},"react-native-keychain"),Object(r.b)("p",null,"Add react-native-keychain - this is a secure keystore library for React Native."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"yarn add react-native-keychain\n")),Object(r.b)("p",null,"Add pods for iOS"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"cd ios && pod install && cd ..\n")),Object(r.b)("p",null,"According to ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://aws-amplify.github.io/docs/js/authentication#managing-security-tokens"}),"official documentation:")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"When using authentication with AWS Amplify, you don\u2019t have to update Amazon Cognito tokens manually. Tokens are automatically updated by the library when necessary. Security tokens, such as IdToken or AccessToken, are stored in localStorage for the browser and in AsyncStorage for React Native. If you want to store these tokens in a more secure place or use Amplify on the server side, you can provide your own storage object for storing these tokens.")),Object(r.b)("p",null,"configure src/index.tsx"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { ReactElement } from 'react'\nimport Amplify from '@aws-amplify/core'\nimport * as Keychain from 'react-native-keychain'\nimport { useColorScheme } from 'react-native-appearance'\nimport ThemeProvider from './ThemeProvider'\nimport AppNavigator from './AppNavigator'\nimport awsconfig from '../aws-exports'\n\nconst DarkTheme = {\n  dark: true,\n  colors: {\n    primary: '#50E3C2',\n    background: '#1D1E1F',\n    card: '#1D1E1F',\n    text: '#ffffff',\n    border: '#ff06f4'\n  }\n}\n\nconst LightTheme = {\n  dark: false,\n  colors: {\n    primary: '#ff06f4',\n    background: '#ffffff',\n    card: '#1D1E1F',\n    text: '#ffffff',\n    border: '#ff06f4'\n  }\n}\n\nconst MEMORY_KEY_PREFIX = '@MyStorage:'\nlet dataMemory: any = {}\nclass MyStorage {\n  static syncPromise = null\n\n  static setItem(key: string, value: string): boolean {\n    Keychain.setGenericPassword(MEMORY_KEY_PREFIX + key, value)\n    dataMemory[key] = value\n    return dataMemory[key]\n  }\n\n  static getItem(key: string): boolean {\n    return Object.prototype.hasOwnProperty.call(dataMemory, key) ? dataMemory[key] : undefined\n  }\n\n  static removeItem(key: string): boolean {\n    Keychain.resetGenericPassword()\n    return delete dataMemory[key]\n  }\n\n  static clear(): object {\n    dataMemory = {}\n    return dataMemory\n  }\n}\n\nAmplify.configure({\n  ...awsconfig,\n  Analytics: {\n    disabled: false\n  },\n  storage: MyStorage\n})\n\nconst App = (): ReactElement => {\n  /**\n   * Subscribe to color scheme changes with a hook\n   */\n  const scheme = useColorScheme()\n  return (\n    <>\n      <ThemeProvider theme={scheme === 'dark' ? DarkTheme : LightTheme}>\n        <AppNavigator />\n      </ThemeProvider>\n    </>\n  )\n}\n\nexport default App\n")),Object(r.b)("p",null,"For client authorization AppSync supports API Keys, Amazon IAM credentials, Amazon Cognito User Pools, and 3rd party OIDC providers. This is inferred from the aws-exports.js file when you call Amplify.configure()."),Object(r.b)("p",null,"When using Authentication with AWS Amplify, you don\u2019t need to refresh Amazon Cognito tokens manually. The tokens are automatically refreshed by the library when necessary.\nSecurity Tokens like IdToken or AccessToken are stored in localStorage for the browser and in AsyncStorage for React Native. If you want to store those tokens in a more secure place or you are using Amplify in server side, then you can provide your own storage object to store those tokens."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/07.png",alt:"Step07"}))),Object(r.b)("h2",{id:"appnavigator"},"AppNavigator"),Object(r.b)("p",null,"Create a navigation configuration file for our custom authentication src/AppNavigator.tsx\nAdd a welcome screen to it."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import * as React from 'react'\nimport { createStackNavigator } from '@react-navigation/stack'\nimport { Hello } from './screens/Authenticator'\n\nconst Stack = createStackNavigator()\n\nexport type RootStackParamList = {\n  HELLO: undefined\n}\n\nconst AppNavigator = () => {\n  return (\n    <Stack.Navigator\n      screenOptions={{\n        headerShown: false\n      }}\n      initialRouteName=\"HELLO\"\n    >\n      <Stack.Screen name=\"HELLO\" component={Hello} />\n    </Stack.Navigator>\n  )\n}\n\nexport default AppNavigator\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/08.png",alt:"Step08"}))),Object(r.b)("h2",{id:"hello-screen"},"Hello screen"),Object(r.b)("p",null,"Create an entry point for our authentication screens src/screens/Authenticator/index.ts"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-04.png",alt:"Hello screen"}))),Object(r.b)("p",null,"To begin with, let's connect welcome screen"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export * from './Hello'\n")),Object(r.b)("p",null,"After we create it src/screens/Authenticator/Hello/index.tsx"),Object(r.b)("p",null,"In the useEffect hook, we check for a user token, where in the case of true we go to the User screen, and in the case of false, we remain on this screen."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useEffect, useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { AppContainer, Button, Space, Txt } from '../../../components'\nimport { onScreen } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'HELLO'>\n\ntype HelloT = {\n  navigation: ProfileScreenNavigationProp\n}\n\nconst Hello = ({ navigation }: HelloT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  useEffect(() => {\n    setLoading(true)\n    const key = async (): Promise<void> => {\n      try {\n        const credentials = await Keychain.getInternetCredentials('auth')\n\n        if (credentials) {\n          const { username, password } = credentials\n          const user = await Auth.signIn(username, password)\n          setLoading(false)\n          user && onScreen('USER', navigation)()\n        } else {\n          setLoading(false)\n        }\n      } catch (err) {\n        console.log('error', err) // eslint-disable-line\n        setLoading(false)\n      }\n    }\n    key()\n  }, []) // eslint-disable-line\n  return (\n    <AppContainer loading={loading}>\n      <Space height={80} />\n      <Button title=\"Sign In\" onPress={onScreen('SIGN_IN', navigation)} />\n      <Space height={10} />\n      <Txt h6 title=\"or\" textStyle={{ alignSelf: 'center' }} />\n      <Space height={15} />\n      <Button title=\"Sign Up\" onPress={onScreen('SIGN_UP', navigation)} />\n    </AppContainer>\n  )\n}\n\nexport { Hello }\n")),Object(r.b)("p",null,"Put together all changes and meet the welcome screen."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/09.png",alt:"Step09"}))),Object(r.b)("h2",{id:"signup-screen"},"SignUp screen"),Object(r.b)("p",null,"We create the registration screen SIGN_UP src/screens/Authenticator/SignUp/index.tsx, where for authentication we use the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js#sign-up"}),"Auth.signUp")," method."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-05.png",alt:"SignUp"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { AppContainer, Space, Button, Input, TextError } from '../../../components'\nimport { onScreen, goBack } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'SIGN_UP'>\n\ntype SignUpT = {\n  navigation: ProfileScreenNavigationProp\n}\n\nconst SignUp = ({ navigation }: SignUpT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values: { email: string; password: string; passwordConfirmation: string }): Promise<void> => {\n    const { email, password, passwordConfirmation } = values\n    if (password !== passwordConfirmation) {\n      setError('Passwords do not match!')\n    } else {\n      setLoading(true)\n      setError('')\n      try {\n        const user = await Auth.signUp(email, password)\n        await Keychain.setInternetCredentials('auth', email, password)\n        user && onScreen('CONFIRM_SIGN_UP', navigation, { email, password })()\n        setLoading(false)\n      } catch (err) {\n        setLoading(false)\n        if (err.code === 'UserNotConfirmedException') {\n          setError('Account not verified yet')\n        } else if (err.code === 'PasswordResetRequiredException') {\n          setError('Existing user found. Please reset your password')\n        } else if (err.code === 'NotAuthorizedException') {\n          setError('Forgot Password?')\n        } else if (err.code === 'UserNotFoundException') {\n          setError('User does not exist!')\n        } else {\n          setError(err.code)\n        }\n      }\n    }\n  }\n\n  return (\n    <>\n      <AppContainer onPress={goBack(navigation)} title=\"Sign Up\" loading={loading}>\n        <Formik\n          initialValues={{ email: '', password: '', passwordConfirmation: '' }}\n          onSubmit={(values): Promise<void> => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string()\n              .email()\n              .required(),\n            password: Yup.string()\n              .min(6)\n              .required(),\n            passwordConfirmation: Yup.string()\n              .min(6)\n              .required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, handleSubmit }): ReactElement => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={(): void => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={(): void => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n                secureTextEntry\n              />\n              <Input\n                name=\"passwordConfirmation\"\n                value={values.passwordConfirmation}\n                onChangeText={handleChange('passwordConfirmation')}\n                onBlur={(): void => setFieldTouched('passwordConfirmation')}\n                placeholder=\"Password confirm\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n                secureTextEntry\n              />\n              <Space height={30} />\n              {error !== '' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              <Button title=\"Sign Up\" onPress={handleSubmit} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { SignUp }\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/10.png",alt:"Step10"}))),Object(r.b)("h2",{id:"confirmsignup-screen"},"ConfirmSignUp screen"),Object(r.b)("p",null,"After a successful response from the server, we go to the confirmation screen and enter the code that came to our mail. To do this, create the screen CONFIRM_SIGN_UP src/screens/Authenticator/ConfirmSignUp/index.tsx"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-06.png",alt:"ConfirmSignUp"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport { Formik } from 'formik'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { RouteProp } from '@react-navigation/native'\nimport * as Yup from 'yup'\nimport { AppContainer, Button, Space, ButtonLink, TextError, Input } from '../../../components'\nimport { onScreen, goBack } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'CONFIRM_SIGN_UP'>\ntype ProfileScreenRouteProp = RouteProp<RootStackParamList, 'CONFIRM_SIGN_UP'>\n\ntype ConfirmSignUpT = {\n  navigation: ProfileScreenNavigationProp\n  route: ProfileScreenRouteProp\n}\n\nconst ConfirmSignUp = ({ route, navigation }: ConfirmSignUpT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values: { code: string }): Promise<void> => {\n    setLoading(true)\n    setError('')\n    try {\n      const { code } = values\n      const { email, password } = route.params\n      await Auth.confirmSignUp(email, code, { forceAliasCreation: true })\n      const user = await Auth.signIn(email, password)\n      user && onScreen('USER', navigation)()\n      setLoading(false)\n    } catch (err) {\n      setLoading(false)\n      setError(err.message)\n      if (err.code === 'UserNotConfirmedException') {\n        setError('Account not verified yet')\n      } else if (err.code === 'PasswordResetRequiredException') {\n        setError('Existing user found. Please reset your password')\n      } else if (err.code === 'NotAuthorizedException') {\n        setError('Forgot Password?')\n      } else if (err.code === 'UserNotFoundException') {\n        setError('User does not exist!')\n      }\n    }\n  }\n\n  const _onResend = async (): Promise<void> => {\n    try {\n      const { email } = route.params\n      await Auth.resendSignUp(email)\n    } catch (err) {\n      setError(err.message)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Confirmation\" onPress={goBack(navigation)} loading={loading}>\n        <Formik\n          initialValues={{ code: '' }}\n          onSubmit={(values): Promise<void> => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            code: Yup.string().min(6).required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, handleSubmit }): ReactElement => (\n            <>\n              <Space height={180} />\n              <Input\n                name=\"code\"\n                value={values.code}\n                onChangeText={handleChange('code')}\n                onBlur={(): void => setFieldTouched('code')}\n                placeholder=\"Insert code\"\n                touched={touched}\n                errors={errors}\n              />\n              <ButtonLink title=\"Resend code?\" onPress={_onResend} textStyle={{ alignSelf: 'center' }} />\n              {error !== 'Forgot Password?' && <TextError title={error} />}\n              <Button title=\"Confirm\" onPress={handleSubmit} />\n              <Space height={50} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { ConfirmSignUp }\n")),Object(r.b)("h2",{id:"resendsignup"},"ResendSignUp"),Object(r.b)("p",null,"If the code has not arrived, then we must provide the user with the opportunity to resend the code.\nTo do this, we put Auth.resendSignUp(userInfo.email) on button Resend code.\nIn case of a successful method call"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.confirmSignUp(email, code, { forceAliasCreation: true })\n")),Object(r.b)("p",null,"we must call the method"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.signIn(email, password)\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/11.png",alt:"Step11"}))),Object(r.b)("h2",{id:"user-screen"},"User screen"),Object(r.b)("p",null,"Once it successfully done, go to the USER screen, which we create with the exit button for the application and clearing the src/screens/Authenticator/User/index.tsx tokens"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-07.png",alt:"User screen"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useState, useEffect, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { AppContainer, Button } from '../../../components'\nimport { goHome } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'HELLO'>\n\ntype UserT = {\n  navigation: ProfileScreenNavigationProp\n}\n\nconst User = ({ navigation }: UserT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    const checkUser = async (): Promise<void> => {\n      await Auth.currentAuthenticatedUser()\n    }\n    checkUser()\n  }, [navigation])\n\n  const _onPress = async (): Promise<void> => {\n    setLoading(true)\n    try {\n      await Auth.signOut()\n      await Keychain.resetInternetCredentials('auth')\n      goHome(navigation)()\n    } catch (err) {\n      setError(err.message)\n    }\n  }\n\n  return (\n    <AppContainer message={error} loading={loading}>\n      <Button title=\"Sign Out\" onPress={_onPress} />\n    </AppContainer>\n  )\n}\n\nexport { User }\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/12.png",alt:"Step12"}))),Object(r.b)("h2",{id:"signin-screen"},"SignIn screen"),Object(r.b)("p",null,"After the user is registered, we must provide the user with the opportunity to enter the application through login and password. To do this, we create the SIGN_IN src/screens/Authenticator/SignIn/index.tsx screen"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-08.png",alt:"SignIn screen"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { AppContainer, Button, Space, ButtonLink, TextError, Input } from '../../../components'\nimport { onScreen, goBack } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'SIGN_IN'>\n\ntype SignUpT = {\n  navigation: ProfileScreenNavigationProp\n}\n\nconst SignIn = ({ navigation }: SignUpT): ReactElement => {\n  const [userInfo, setUserInfo] = useState({ email: '', password: '' })\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values: { email: string; password: string }): Promise<void> => {\n    setLoading(true)\n    setError('')\n    try {\n      const { email, password } = values\n      const user = await Auth.signIn(email, password)\n      await Keychain.setInternetCredentials('auth', email, password)\n      user && onScreen('USER', navigation)()\n      setLoading(false)\n    } catch ({ code }) {\n      setLoading(false)\n      if (code === 'UserNotConfirmedException') {\n        setError('Account not verified yet')\n      } else if (code === 'PasswordResetRequiredException') {\n        setError('Existing user found. Please reset your password')\n      } else if (code === 'NotAuthorizedException') {\n        setUserInfo(values)\n        setError('Forgot Password?')\n      } else if (code === 'UserNotFoundException') {\n        setError('User does not exist!')\n      } else {\n        setError(code)\n      }\n    }\n  }\n\n  return (\n    <>\n      <AppContainer onPress={goBack(navigation)} title=\"Sign In\" loading={loading} message={error}>\n        <Formik\n          enableReinitialize\n          initialValues={userInfo}\n          onSubmit={(values): Promise<void> => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string()\n              .email()\n              .required(),\n            password: Yup.string()\n              .min(6)\n              .required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, handleSubmit }): ReactElement => (\n            <>\n              <Space height={90} />\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={(): void => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={(): void => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n                secureTextEntry\n              />\n              {error !== 'Forgot Password?' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              {error === 'Forgot Password?' && (\n                <ButtonLink\n                  title={error}\n                  onPress={onScreen('FORGOT', navigation, userInfo)}\n                  textStyle={{ alignSelf: 'center' }}\n                />\n              )}\n              <Button title=\"Sign In\" onPress={handleSubmit} />\n              <Space height={130} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { SignIn }\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/13.png",alt:"Step13"}))),Object(r.b)("h2",{id:"forgot-password-screen"},"Forgot password screen"),Object(r.b)("p",null,"If successful, we send the user to the USER screen, which we have already done, and if the user has forgotten or entered the password incorrectly, then we show the Forgot Password error and suggest resetting the password."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-09.png",alt:"Forgot password"}))),Object(r.b)("p",null,"To do this, we create the FORGOT src/screens/Authenticator/Forgot/index.tsx screen"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-10.png",alt:"Forgot password"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { RouteProp } from '@react-navigation/native'\nimport { AppContainer, Button, Input, Space } from '../../../components'\nimport { onScreen, goBack } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'FORGOT'>\ntype ProfileScreenRouteProp = RouteProp<RootStackParamList, 'FORGOT'>\n\ntype ForgotT = {\n  navigation: ProfileScreenNavigationProp\n  route: ProfileScreenRouteProp\n}\n\nconst Forgot = ({ route, navigation }: ForgotT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values: { email: string }): Promise<void> => {\n    setLoading(true)\n    try {\n      const { email } = values\n      const user = await Auth.forgotPassword(email)\n      user && onScreen('FORGOT_PASSWORD_SUBMIT', navigation, values)()\n      setLoading(false)\n    } catch (err) {\n      setError(error)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Forgot\" onPress={goBack(navigation)} loading={loading} message={error}>\n        <Formik\n          initialValues={{ email: route.params.email || '' }}\n          onSubmit={(values): Promise<void> => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string()\n              .email()\n              .required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, handleSubmit }): ReactElement => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={(): void => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Space height={30} />\n              <Button title=\"Confirm\" onPress={handleSubmit} />\n              <Space height={100} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { Forgot }\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/14.png",alt:"Step14"}))),Object(r.b)("h2",{id:"forgot-password-submit"},"Forgot password submit"),Object(r.b)("p",null,"After confirming the e-mail, we call the Auth.forgotPassword (email) method and if there is such a user, we send the user to the FORGOT_PASSWORD_SUBMIT src/screens/Authenticator/ForgotPassSubmit/index.tsx screen"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/auth/auth1-11.png",alt:"ForgotPassSubmit"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx"}),"import React, { useState, ReactElement } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { StackNavigationProp } from '@react-navigation/stack'\nimport { RouteProp } from '@react-navigation/native'\nimport { AppContainer, Button, Space, Input, TextError } from '../../../components'\nimport { onScreen, goBack } from '../../../constants'\nimport { RootStackParamList } from '../../../AppNavigator'\n\ntype ProfileScreenNavigationProp = StackNavigationProp<RootStackParamList, 'FORGOT_PASSWORD_SUBMIT'>\ntype ProfileScreenRouteProp = RouteProp<RootStackParamList, 'FORGOT_PASSWORD_SUBMIT'>\n\ntype ForgotPassSubmitT = {\n  navigation: ProfileScreenNavigationProp\n  route: ProfileScreenRouteProp\n}\n\nconst ForgotPassSubmit = ({ route, navigation }: ForgotPassSubmitT): ReactElement => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values: { email: string; password: string; code: string }): Promise<void> => {\n    setLoading(true)\n    try {\n      const { email, code, password } = values\n      await Auth.forgotPasswordSubmit(email, code, password)\n      await Keychain.setInternetCredentials('auth', email, password)\n      onScreen('USER', navigation)()\n      setLoading(false)\n    } catch (err) {\n      setLoading(false)\n      setError(err.message)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Confirmation\" onPress={goBack(navigation)} loading={loading} message={error}>\n        <Formik\n          initialValues={{ email: route.params.email || '', code: '', password: '', passwordConfirmation: '' }}\n          onSubmit={(values): Promise<void> => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string()\n              .email()\n              .required(),\n            code: Yup.string()\n              .min(6)\n              .required(),\n            password: Yup.string()\n              .min(6)\n              .required(),\n            passwordConfirmation: Yup.string()\n              .min(6)\n              .required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, handleSubmit }): ReactElement => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={(): void => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"code\"\n                value={values.code}\n                onChangeText={handleChange('code')}\n                onBlur={(): void => setFieldTouched('code')}\n                placeholder=\"Code\"\n                touched={touched}\n                errors={errors}\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={(): void => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n                secureTextEntry\n              />\n              <Input\n                name=\"passwordConfirmation\"\n                value={values.passwordConfirmation}\n                onChangeText={handleChange('passwordConfirmation')}\n                onBlur={(): void => setFieldTouched('passwordConfirmation')}\n                placeholder=\"Password confirm\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n                secureTextEntry\n              />\n              {error !== '' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              <Space height={30} />\n              <Button title=\"Confirm\" onPress={handleSubmit} />\n              <Space height={80} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { ForgotPassSubmit }\n")),Object(r.b)("p",null,"where, after entering the code sent to the mail, the new password and confirming it, we call the password change method"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.forgotPasswordSubmit(email, code, password)\n")),Object(r.b)("p",null,"whose success sends the user to the USER screen."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/15.png",alt:"Step15"}))),Object(r.b)("h2",{id:"linking-screens"},"Linking screens"),Object(r.b)("p",null,"We connect all created components in src/screens/Authenticator/index.ts"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"export * from './Hello'\nexport * from './User'\nexport * from './SignIn'\nexport * from './SignUp'\nexport * from './Forgot'\nexport * from './ForgotPassSubmit'\nexport * from './ConfirmSignUp'\n")),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/16.png",alt:"Step16"}))),Object(r.b)("h2",{id:"udpate-appnavigator"},"Udpate AppNavigator"),Object(r.b)("p",null,"Updating the navigation configuration file src/AppNavigator.tsx :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),'import * as React from \'react\'\nimport { createStackNavigator } from \'@react-navigation/stack\'\nimport { Hello, SignUp, SignIn, ConfirmSignUp, User, Forgot, ForgotPassSubmit } from \'./screens/Authenticator\'\n\nconst Stack = createStackNavigator()\n\nexport type RootStackParamList = {\n  HELLO: undefined\n  SIGN_UP: undefined\n  SIGN_IN: undefined\n  FORGOT: { email: string }\n  FORGOT_PASSWORD_SUBMIT: { email: string }\n  CONFIRM_SIGN_UP: { email: string; password: string }\n  USER: undefined\n}\n\nconst AppNavigator = (): React.ReactElement => {\n  return (\n    <Stack.Navigator\n      screenOptions={{\n        headerShown: false\n      }}\n      initialRouteName="HELLO"\n    >\n      <Stack.Screen name="HELLO" component={Hello} />\n      <Stack.Screen name="SIGN_UP" component={SignUp} />\n      <Stack.Screen name="SIGN_IN" component={SignIn} />\n      <Stack.Screen name="FORGOT" component={Forgot} />\n      <Stack.Screen name="FORGOT_PASSWORD_SUBMIT" component={ForgotPassSubmit} />\n      <Stack.Screen name="CONFIRM_SIGN_UP" component={ConfirmSignUp} />\n      <Stack.Screen name="USER" component={User} />\n    </Stack.Navigator>\n  )\n}\n\nexport default AppNavigator\n')),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/steps/17.png",alt:"Step17"}))),Object(r.b)("h2",{id:"debug"},"Debug"),Object(r.b)("p",null,"In order to understand what happens with tokens in your application, add in the root/index.js"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-jsx"}),"window.LOG_LEVEL = 'DEBUG'\n")),Object(r.b)("p",null,"We launch the application and get custom authentication."),Object(r.b)("h2",{id:"done-"},"Done \u2705"),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.patreon.com/bePatron?u=34467235"}),Object(r.b)("img",Object(a.a)({parentName:"a"},{src:"/img/logo/patreon.png",alt:"Become a Patron!"})))))}l.isMDXComponent=!0},174:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return g}));var a=t(0),r=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),p=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s({},n,{},e)),t},u=function(e){var n=p(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=Object(a.forwardRef)((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(t),d=a,g=u["".concat(i,".").concat(d)]||u[d]||m[d]||o;return t?r.a.createElement(g,s({ref:n},l,{components:t})):r.a.createElement(g,s({ref:n},l))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);